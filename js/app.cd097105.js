(function(e){function t(t){for(var n,i,c=t[0],s=t[1],l=t[2],p=0,d=[];p<c.length;p++)i=c[p],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&d.push(o[i][0]),o[i]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);u&&u(t);while(d.length)d.shift()();return r.push.apply(r,l||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],n=!0,c=1;c<a.length;c++){var s=a[c];0!==o[s]&&(n=!1)}n&&(r.splice(t--,1),e=i(i.s=a[0]))}return e}var n={},o={app:0},r=[];function i(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=n,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var u=s;r.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("cd49")},"0751":function(e,t,a){"use strict";var n=a("48f3"),o=a.n(n);o.a},"198a":function(e,t,a){"use strict";var n=a("f683"),o=a.n(n);o.a},"1e93":function(e,t,a){},"2aca":function(e,t,a){},"312b":function(e,t,a){"use strict";var n=a("1e93"),o=a.n(n);o.a},"31aa":function(e,t,a){},3385:function(e,t,a){},"3a40":function(e,t,a){"use strict";var n=a("7fe3"),o=a.n(n);o.a},"3a8e":function(e,t,a){"use strict";var n=a("5756"),o=a.n(n);o.a},"48f0":function(e,t,a){},"48f3":function(e,t,a){},"49a2":function(e,t,a){"use strict";var n=a("503d"),o=a.n(n);o.a},"4d25":function(e,t,a){},"503d":function(e,t,a){},5756:function(e,t,a){},5960:function(e,t,a){},"5c0b":function(e,t,a){"use strict";var n=a("9c0c"),o=a.n(n);o.a},"6bd7":function(e,t,a){"use strict";var n=a("ac00"),o=a.n(n);o.a},"7fe3":function(e,t,a){},8271:function(e,t,a){},9769:function(e,t,a){"use strict";var n=a("48f0"),o=a.n(n);o.a},"9c0c":function(e,t,a){},a3a1:function(e,t,a){"use strict";var n=a("3385"),o=a.n(n);o.a},a470:function(e,t,a){"use strict";var n=a("5960"),o=a.n(n);o.a},ac00:function(e,t,a){},aee9:function(e,t,a){},c96d:function(e,t,a){"use strict";var n=a("4d25"),o=a.n(n);o.a},ccd1:function(e,t,a){"use strict";var n=a("2aca"),o=a.n(n);o.a},cd49:function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n,o,r=a("2b0e"),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("app-navbar",{attrs:{hide:e.appState.factoryFormOpen||e.appState.selectFactoryMode,fixed:!0},on:{menu:e.modalActions.toggleSidebar}},[e._v("農地違章工廠舉報")]),a("app-sidebar",{attrs:{clickActions:e.sidebarActions},model:{value:e.modalState.sidebarOpen,callback:function(t){e.$set(e.modalState,"sidebarOpen",t)},expression:"modalState.sidebarOpen"}}),a("filter-modal",{attrs:{open:e.appState.filterModalOpen,dismiss:e.closeFilterModal}}),a("create-factory-success-modal",{attrs:{open:e.modalState.createFactorySuccessModal,dismiss:e.modalActions.closeCreateFactorySuccessModal}}),a("update-factory-success-modal",{attrs:{open:e.modalState.updateFactorySuccessModal,dismiss:e.modalActions.closeUpdateFactorySuccessModal}}),a("about-modal",{attrs:{open:e.modalState.aboutModalOpen,dismiss:e.modalActions.closeAboutModal}}),a("contact-modal",{attrs:{open:e.modalState.contactModalOpen,dismiss:e.modalActions.closeContactModal}}),a("getting-started-modal",{attrs:{open:e.modalState.gettingStartedModalOpen,dismiss:e.modalActions.closeGettingStartedModal}}),a("safety-modal",{attrs:{open:e.modalState.safetyModalOpen,dismiss:e.modalActions.closeSafetyModal}}),a("Map",{attrs:{openCreateFactoryForm:e.openCreateFactoryForm,openEditFactoryForm:e.openEditFactoryForm,selectFactoryMode:e.appState.selectFactoryMode,enterSelectFactoryMode:e.enterSelectFactoryMode,exitSelectFactoryMode:e.exitSelectFactoryMode,setFactoryLocation:e.setFactoryLocation,openFilterModal:e.openFilterModal}}),e.appState.factoryFormOpen?a("form-page",{attrs:{mode:e.appState.formMode,factoryData:e.appState.factoryData,close:e.closeFactoryPage,selectFactoryMode:e.appState.selectFactoryMode,enterSelectFactoryMode:e.enterSelectFactoryMode,exitSelectFactoryMode:e.exitSelectFactoryMode,factoryLocation:e.appState.factoryLocation,setCreateFactorySuccessModal:e.setCreateFactorySuccessModal}}):e._e()],1)},c=[],s=a("e587"),l=a("750b"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.selectFactoryMode?a("div",{staticClass:"navbar-container"},[a("app-navbar",{attrs:{dark:!1,fixed:!0},on:{back:e.onNavBack,menu:e.modalActions.toggleSidebar}},[e._v(" 新增資訊 ")])],1):e._e(),a("div",{staticClass:"map-container"},[a("div",{ref:"root",staticClass:"map"}),a("div",{ref:"popup",class:["popup",{show:e.popupData.show}],style:{borderColor:e.popupData.color}},[a("div",{staticClass:"close",on:{click:function(t){e.popupData.show=!1}}}),a("small",{style:{color:e.popupData.color}},[e._v(e._s(e.popupData.status))]),a("h3",[e._v(e._s(e.popupData.name))]),a("p",{staticClass:"summary"},[e._v(e._s(e.popupData.summary))]),a("app-button",{attrs:{outline:"",color:e.getButtonColorFromStatus()},on:{click:e.onClickEditFactoryData}},[e._v(" 補充資料 ")])],1),a("div",{staticClass:"ol-map-search ol-unselectable ol-control",on:{click:e.openFilterModal}},[e._m(0)]),a("div",{staticClass:"ol-fit-location ol-unselectable ol-control",on:{click:e.zoomToGeolocation}},[e._m(1)]),e.selectFactoryMode?a("div",{staticClass:"center-point"}):e._e(),a("div",{staticClass:"factory-button-group"},[e.selectFactoryMode?e._e():a("div",{staticClass:"create-factory-button"},[a("app-button",{on:{click:e.onClickCreateFactoryButton}},[e._v("我要新增違建工廠")])],1),e.selectFactoryMode?a("div",{staticClass:"choose-location-button"},[a("app-button",{attrs:{disabled:!e.factoryValid},on:{click:e.onClickFinishSelectFactoryPositionButton}},[e._v(" 選擇此地點 ")]),a("span",[e._v("可舉報範圍：白色區域")])],1):e._e()])])])},p=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("button",[a("img",{attrs:{src:"/images/search.svg",alt:"search"}})])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("button",[a("img",{attrs:{src:"/images/locate.svg",alt:"locate"}})])}],d=(a("4de4"),a("7db0"),a("caad"),a("a15b"),a("d81d"),a("b0c0"),a("2532"),a("2fa7")),f=(a("96cf"),a("9ab4")),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("button",{class:{outline:e.outline,disabled:e.disabled,rect:e.rect,blue:"blue"===e.color,red:"red"===e.color,gray:"gray"===e.color},on:{click:e.click}},[e._t("default")],2)},v=[],y=Object(l["b"])({name:"AppButton",props:{outline:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},rect:{type:Boolean,default:!1},color:{type:String,default:"default"}},setup:function(e,t){var a=function(){e.disabled||t.emit("click")};return{click:a}}}),g=y,b=(a("a3a1"),a("2877")),h=Object(b["a"])(g,m,v,!1,null,"3c93b5ae",null),S=h.exports,F=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("nav",{class:{dark:e.dark,fixed:e.fixed,hide:e.hide}},[a("div",{directives:[{name:"show",rawName:"v-show",value:!e.dark,expression:"!dark"}],staticClass:"back-button",on:{click:function(t){return e.onBackClick()}}},[a("span"),a("span"),a("span")]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.dark,expression:"dark"}],staticClass:"back-placeholder"}),e._t("default"),a("div",{staticClass:"menu-button",on:{click:function(t){return e.onMenuClick()}}},[a("span"),a("span"),a("span")])],2)},O=[],_=Object(l["b"])({name:"AppNavbar",props:{dark:{type:Boolean,default:!0},fixed:{type:Boolean,default:!1},back:{type:Function},hide:{type:Boolean,default:!1}},setup:function(e,t){var a=t.emit;return{onBackClick:function(){a("back")},onMenuClick:function(){a("menu")}}}}),w=_,M=(a("d54a"),Object(b["a"])(w,F,O,!1,null,"1c931af2",null)),k=M.exports,x=(a("4160"),a("13d5"),a("4ec9"),a("a9e3"),a("9129"),a("4fad"),a("d3b7"),a("3ca3"),a("159b"),a("ddb0"),a("284c")),E=a("9f12"),j=a("53fe"),C=a("4cdf"),I=a("a2c7"),A=a("5eee"),T=a("6c77"),P=a("6cbf"),L=a("ce2c"),U=a("83a6"),R=a("8682"),G=a("82b0"),N=a("f403"),B=a("d510"),D=a("6ed8"),V=a("256f"),$=a("0af5"),q=a("3e6b"),z=a("480c"),X=a("5831"),W=a("d0e9"),H=a("e29f"),J=a("9d47"),Y=a("a7f7"),Z=a("f53f"),K=a("3a39"),Q=a("508e"),ee=[{value:"2-1",text:"金屬: 沖床、銑床、車床、鏜孔"},{value:"2-2",text:"金屬: 焊接、鑄造、熱處理"},{value:"2-3",text:"金屬: 金屬表面處理、噴漆"},{value:"3",text:"塑膠加工、射出"},{value:"4",text:"橡膠加工"},{value:"5",text:"非金屬礦物（石材）"},{value:"6",text:"食品"},{value:"7",text:"皮革"},{value:"8",text:"紡織"},{value:"9",text:"其他"}];(function(e){e["NEW"]="NEW",e["EXISTING_INCOMPLETE"]="EXISTING_INCOMPLETE",e["EXISTING_COMPLETE"]="EXISTING_COMPLETE",e["REPORTED"]="REPORTED"})(o||(o={}));var te,ae=(n={},Object(d["a"])(n,o.NEW,["新建違章工廠"]),Object(d["a"])(n,o.EXISTING_COMPLETE,["既有違章工廠"]),Object(d["a"])(n,o.EXISTING_INCOMPLETE,["既有違章工廠","資料不齊"]),Object(d["a"])(n,o.REPORTED,["已舉報違章工廠"]),n),ne=[o.NEW,o.EXISTING_COMPLETE,o.EXISTING_INCOMPLETE,o.REPORTED],oe=(a("a630"),a("fb6a"),a("45fc"),window.OffscreenCanvas?new OffscreenCanvas(500,500):document.createElement("canvas")),re=oe.getContext("2d"),ie=function(e){return function(t){return new Promise((function(a){var n=new Image;n.crossOrigin="",n.src=t,n.style.display="none",n.onload=function(){return Object(f["a"])(void 0,void 0,void 0,regeneratorRuntime.mark((function t(){var o,r,i,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return oe.width=n.width,oe.height=n.height,re.clearRect(0,0,oe.width,oe.height),re.drawImage(n,0,0),o=re.getImageData(0,0,n.width,n.height),r=o.data,t.next=8,Promise.resolve(e(r));case 8:i=document.createElement("canvas"),c=i.getContext("2d"),i.width=n.width,i.height=n.height,c.putImageData(o,0,0),a(i.toDataURL()),n.remove(),i.remove();case 16:case"end":return t.stop()}}),t)})))}}))}},ce=(ie((function(e){for(var t=0;t<e.length;t+=4){var a=(e[t]+e[t+1]+e[t+2])/3;e[t]=a,e[t+1]=a,e[t+2]=a}})),[[255,241,0]]),se=function(e,t){return!e.some((function(e,a){return t[a]!==e}))},le=function(e){return ce.some((function(t){return se(t,e)}))},ue=ie((function(e){for(var t=0;t<e.length;t+=4){var a=Array.from(e.slice(t,t+3));le(a)?(e[t]=0,e[t+1]=0,e[t+2]=0,e[t+3]=1):(e[t]=0,e[t+1]=0,e[t+2]=0,e[t+3]=255)}})),pe=a("d202"),de=function(e){return"/images/marker-".concat(e,".svg")},fe=function(e){var t;return(t={},Object(d["a"])(t,o.NEW,"#447287"),Object(d["a"])(t,o.EXISTING_COMPLETE,"#58585B"),Object(d["a"])(t,o.EXISTING_INCOMPLETE,"#58585B"),Object(d["a"])(t,o.REPORTED,"#6D8538"),t)[e]};function me(e){return"B"===e.cet_report_status?o.REPORTED:e.before_release?e.data_complete?o.EXISTING_COMPLETE:o.EXISTING_INCOMPLETE:o.NEW}(function(e){e[e["OSM"]=0]="OSM",e[e["TAIWAN"]=1]="TAIWAN",e[e["SATELITE"]=2]="SATELITE"})(te||(te={}));var ve=function(){return Object.entries({zoomIn:"/images/zoom-in.svg",zoomOut:"/images/zoom-out.svg"}).reduce((function(e,t){var a=Object(s["a"])(t,2),n=a[0],o=a[1],r=document.createElement("img");return r.setAttribute("src",o),Object.assign(Object.assign({},e),Object(d["a"])({},n,r))}),{})},ye=Object.entries(o).reduce((function(e,t){var a=Object(s["a"])(t,2),n=a[0],o=a[1];return Object.assign(Object.assign({},e),Object(d["a"])({},n,new T["b"]({image:new P["a"]({anchorYUnits:G["a"].PIXELS,anchorOrigin:pe["a"].BOTTOM_LEFT,src:de(o)})})))}),{}),ge=new T["b"]({}),be=new T["b"]({image:new L["a"]({fill:new U["a"]({color:"#A22929"}),radius:12,stroke:new R["a"]({color:"#FFFFFF",width:1})})}),he=function(){function e(t){Object(E["a"])(this,e),this.appliedFilters=[],this.factoryMap=new Map,this._map=t}return Object(j["a"])(e,[{key:"getFactory",value:function(e){return this.factoryMap.get(e)}},{key:"updateFactory",value:function(e,t){this.factoryMap.set(e,t)}},{key:"addFactories",value:function(e){var t=this,a=this.createFactoryFeature.bind(this),n=e.filter((function(e){return!t.factoryMap.has(e.id)})).map(a);this.factoriesLayerSource.addFeatures(n),e.forEach((function(e){return t.updateFactory(e.id,e)}))}},{key:"hideFactories",value:function(e){var t=this;e.forEach((function(e){var a=t.factoriesLayerSource.getFeatureById(e.id);a.setStyle(ge)}))}},{key:"setFactoryStatusFilter",value:function(e){if(this.appliedFilters=e,0===e.length)return this.displayAllFactory();this.updateFactoriesFeatureStyle()}},{key:"isFactoryVisible",value:function(e){return 0===this.appliedFilters.length||this.appliedFilters.includes(me(e))}},{key:"getFactoryStyle",value:function(e){var t=this.isFactoryVisible(e);return t?ye[me(e)]:ge}},{key:"createFactoryFeature",value:function(e){var t=new C["a"]({geometry:new N["a"](Object(V["i"])([e.lng,e.lat],"EPSG:4326","EPSG:3857"))});return t.setId(e.id),t.setStyle(this.getFactoryStyle(e)),t}},{key:"forEachFeatureFactory",value:function(e){var t=this;this.factoriesLayerSource.getFeatures().forEach((function(a){var n=a.getId(),o=t.factoryMap.get(n);e(a,o)}))}},{key:"displayAllFactory",value:function(){this.forEachFeatureFactory((function(e,t){e.setStyle(ye[me(t)])}))}},{key:"updateFactoriesFeatureStyle",value:function(){var e=this;this.forEachFeatureFactory((function(t,a){t.setStyle(e.getFactoryStyle(a))}))}},{key:"mapInstance",get:function(){return this._map}},{key:"factories",get:function(){return Object(x["a"])(this.factoryMap.values())}},{key:"factoriesLayerSource",get:function(){if(!this._factoriesLayerSource){this._factoriesLayerSource=new X["a"]({features:[]});var e=new q["a"]({source:this._factoriesLayerSource,zIndex:3});this.mapInstance.map.addLayer(e)}return this._factoriesLayerSource}}]),e}(),Se=function(){for(var e=Object(V["d"])("EPSG:3857"),t=e.getExtent(),a=new Array(21),n=Object($["E"])(t)/256,o=new Array(21),r=0;r<21;++r)a[r]=n/Math.pow(2,r),o[r]=r;return new D["b"]({origin:Object($["C"])(t),resolutions:a,matrixIds:o})},Fe=function(e,t){var a=function(){switch(e){case te.OSM:return new W["a"]({crossOrigin:"Anonymous",attributions:'<a href="https://osm.tw/" target="_blank">OpenStreetMap 台灣</a>'});case te.TAIWAN:return new B["a"]({matrixSet:"EPSG:3857",format:"image/png",url:"https://wmts.nlsc.gov.tw/wmts",layer:"EMAP",tileGrid:t,crossOrigin:"Anonymous",style:"default",wrapX:!0,attributions:'<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'});case te.SATELITE:return new B["a"]({matrixSet:"EPSG:3857",format:"image/png",url:"https://wmts.nlsc.gov.tw/wmts/PHOTO_MIX/default/EPSG:3857/{TileMatrix}/{TileRow}/{TileCol}",layer:"EMAP",tileGrid:t,requestEncoding:"REST",crossOrigin:"Anonymous",style:"default",wrapX:!0,attributions:'<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'});default:return new W["a"]({crossOrigin:"Anonymous",attributions:'<a href="https://osm.tw/" target="_blank">OpenStreetMap 台灣</a>'})}}();return new z["a"]({source:a,opacity:.6,zIndex:1})},Oe=function(e){return new z["a"]({source:new B["a"]({matrixSet:"EPSG:3857",format:"image/png",url:"https://wmts.nlsc.gov.tw/wmts/nURBAN2/default/EPSG:3857/{TileMatrix}/{TileRow}/{TileCol}",layer:"LUIMAP",requestEncoding:"REST",tileGrid:e,tileLoadFunction:function(e,t){var a=e.getImage();ue(t).then((function(e){a.src=e}))},crossOrigin:"Anonymous",style:"default",wrapX:!0,attributions:'<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),opacity:.5,zIndex:2})},_e=function(){function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(E["a"])(this,e),this.tileGrid=Se(),this.mapDom=t,this.baseLayer=Fe(te.OSM,this.tileGrid),this._map=this.instantiateOLMap(this.mapDom,this.baseLayer,n),n.minimap||(this.geolocation=this.setupGeolocationTracking(this._map)),this.setupEventListeners(this._map,a)}return Object(j["a"])(e,[{key:"setupEventListeners",value:function(e,t){var a=this,n=function(){return Object(f["a"])(a,void 0,void 0,regeneratorRuntime.mark((function a(){var n,o,r,i,c,l,u,p,d,f,m,v;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=e.getView(),o=n.getZoom(),r=n.getResolutionForZoom(o),i=Math.ceil(r/2),c=Object(V["i"])(n.getCenter(),"EPSG:3857","EPSG:4326"),l=Object(s["a"])(c,2),u=l[0],p=l[1],!t.onMoved){a.next=11;break}return d=this.mapDom.getBoundingClientRect(),f=d.width,m=d.height,a.next=9,this.canPlaceFactory([f/2,m/2]);case 9:v=a.sent,t.onMoved([u,p,i],v);case 11:case"end":return a.stop()}}),a,this)})))};e.on("change:resolution",n),e.on("moveend",n),e.on("click",(function(n){return Object(f["a"])(a,void 0,void 0,regeneratorRuntime.mark((function a(){var o,r,i,c,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.onClicked&&(o=Object(V["i"])(n.coordinate,"EPSG:3857","EPSG:4326"),r=Object(s["a"])(o,2),i=r[0],c=r[1],l=e.forEachFeatureAtPixel(n.pixel,(function(e){return e})),t.onClicked([i,c],l));case 1:case"end":return a.stop()}}),a)})))}))}},{key:"instantiateOLMap",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Se(),o=new I["a"]({center:Object(V["i"])([120.1,23.234],"EPSG:4326","EPSG:3857"),zoom:16}),r=ve(),i={target:e,layers:[t,Oe(n)],view:o,controls:[new H["a"]({zoomInLabel:r.zoomIn,zoomOutLabel:r.zoomOut}),new J["a"],new Y["a"]],interactions:Object(K["a"])({pinchRotate:!1}).extend([new Q["a"]({threshold:.4})])};return a.minimap&&(i.controls=[],i.interactions=[]),new A["a"](i)}},{key:"setupGeolocationTracking",value:function(e){var t=e.getView(),a=new Z["a"]({trackingOptions:{enableHighAccuracy:!0},projection:t.getProjection()});a.setTracking(!0);var n=this.setupGeolocationLayer(a);return e.addLayer(n),a}},{key:"setupGeolocationLayer",value:function(e){var t=this,a=new C["a"],n=function(e){return Number.isNaN(e)?new T["b"]({image:new L["a"]({fill:new U["a"]({color:"#0099ff"}),stroke:new R["a"]({color:"#fff",width:3}),radius:15})}):new T["b"]({image:new P["a"]({anchor:[.5,.5],src:"/images/now.svg",rotation:e,rotateWithView:!0})})};a.setStyle(n(NaN)),e.on("change:position",(function(){var t=e.getPosition();a.setGeometry(t?new N["a"](t):void 0)})),e.on("change:heading",(function(){var t;a.setStyle(n((t=e.getHeading(),null!==t&&void 0!==t?t:NaN)))}));var o=new C["a"];e.on("change:accuracyGeometry",(function(){o.setGeometry(e.getAccuracyGeometry())}));var r=!1;e.on("change",(function(){if(!r){var a=e.getPosition();a&&(t.zoomToGeolocation(),r=!0)}}));var i=new q["a"]({source:new X["a"]({features:[a,o]}),zIndex:5});return i}},{key:"zoomToGeolocation",value:function(){if(this.geolocation){var e=this.geolocation.getPosition();if(e){var t=this._map.getView();t.setCenter(e),t.setZoom(16)}}}},{key:"changeBaseMap",value:function(e){this._map.removeLayer(this.baseLayer),this.baseLayer=Fe(e,this.tileGrid),this._map.addLayer(this.baseLayer)}},{key:"canPlaceFactory",value:function(e){var t=this;return new Promise((function(a){t._map.forEachLayerAtPixel(e,(function(e,t){var n=Object(s["a"])(t,4),o=n[3];return a(1===o)}),{layerFilter:function(e){return"LUIMAP"===e.getProperties().source.layer_}}),a(!1)}))}},{key:"getLUIMAPLayer",value:function(){var e=this;return new Promise((function(t,a){var n;e._map.getLayers().forEach((function(e){"LUIMAP"===e.getProperties().source.layer_&&(n=e,t(e))})),n||a(new TypeError("LUIMAP Layer not found"))}))}},{key:"setLUILayerVisible",value:function(e){return Object(f["a"])(this,void 0,void 0,regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getLUIMAPLayer();case 2:a=t.sent,a.setVisible(e);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"setMinimapPin",value:function(e,t){var a=Object(V["i"])([e,t],"EPSG:4326","EPSG:3857");if(this.minimapPinFeature)this.minimapPinFeature.setGeometry(new N["a"](a));else{var n=new C["a"]({geometry:new N["a"](a)});n.setStyle(be),this.minimapPinFeature=n;var o=new X["a"]({features:[n]}),r=new q["a"]({source:o,zIndex:4});this.map.addLayer(r)}this._map.getView().setCenter(a)}},{key:"map",get:function(){return this._map}}]),e}();function we(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new _e(e,t);return window.changeBaseMap=a.changeBaseMap.bind(a),new he(a)}function Me(e,t){var a=new _e(e,{},{minimap:!0});return a.map.getView().setCenter(t),new he(a)}a("a4d3"),a("e01a"),a("d28b"),a("99af"),a("2b3d");var ke=a("bc3a"),xe=a.n(ke),Ee="https://api.disfactory.tw/api",je=xe.a.create({baseURL:Ee,headers:{"Content-Type":"application/json"}});function Ce(e,t,a){return Object(f["a"])(this,void 0,void 0,regeneratorRuntime.mark((function n(){var o,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,je.get("/factories?range=".concat(e,"&lng=").concat(t,"&lat=").concat(a));case 3:return o=n.sent,r=o.data,n.abrupt("return",r);case 8:throw n.prev=8,n.t0=n["catch"](0),console.error(n.t0),new TypeError("Get factory failed");case 12:case"end":return n.stop()}}),n,null,[[0,8]])})))}function Ie(e){return Object(f["a"])(this,void 0,void 0,regeneratorRuntime.mark((function t(){var a,n,o,r,i,c,s,l,u,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=[],n=!0,o=!1,r=void 0,t.prev=4,i=e[Symbol.iterator]();case 6:if(n=(c=i.next()).done){t.next=18;break}return s=c.value,l=new FormData,l.append("image",s),t.next=12,je.post("/images",l,{headers:{"Content-Type":"multipart/form-data"}});case 12:u=t.sent,p=u.data,a.push({token:p.token,src:URL.createObjectURL(s)});case 15:n=!0,t.next=6;break;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t["catch"](4),o=!0,r=t.t0;case 24:t.prev=24,t.prev=25,n||null==i.return||i.return();case 27:if(t.prev=27,!o){t.next=30;break}throw r;case 30:return t.finish(27);case 31:return t.finish(24);case 32:return t.abrupt("return",a);case 33:case"end":return t.stop()}}),t,null,[[4,20,24,32],[25,,27,31]])})))}function Ae(e,t,a){var n=a.nickname,o=a.contact;return Object(f["a"])(this,void 0,void 0,regeneratorRuntime.mark((function a(){var r,i,c,s,l,u,p,d,f,m;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:r=[],i=!0,c=!1,s=void 0,a.prev=4,l=t[Symbol.iterator]();case 6:if(i=(u=l.next()).done){a.next=20;break}return p=u.value,d=new FormData,d.append("image",p),n&&d.append("nickname",n),o&&d.append("contact",o),a.next=14,je.post("/factories/".concat(e,"/images"),d,{headers:{"Content-Type":"multipart/form-data"}});case 14:f=a.sent,m=f.data,r.push(m);case 17:i=!0,a.next=6;break;case 20:a.next=26;break;case 22:a.prev=22,a.t0=a["catch"](4),c=!0,s=a.t0;case 26:a.prev=26,a.prev=27,i||null==l.return||l.return();case 29:if(a.prev=29,!c){a.next=32;break}throw s;case 32:return a.finish(29);case 33:return a.finish(26);case 34:return a.abrupt("return",r);case 35:case"end":return a.stop()}}),a,null,[[4,22,26,34],[27,,29,33]])})))}function Te(e){return Object(f["a"])(this,void 0,void 0,regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,je.post("/factories",JSON.stringify(e));case 3:return a=t.sent,n=a.data,t.abrupt("return",n);case 8:throw t.prev=8,t.t0=t["catch"](0),console.error(t.t0),new TypeError("Create factory failed");case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))}function Pe(e,t){return Object(f["a"])(this,void 0,void 0,regeneratorRuntime.mark((function a(){var n,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,je.put("/factories/".concat(e),JSON.stringify(t));case 3:return n=a.sent,o=n.data,a.abrupt("return",o);case 8:throw a.prev=8,a.t0=a["catch"](0),console.error(a.t0),new TypeError("Update factory failed");case 12:case"end":return a.stop()}}),a,null,[[0,8]])})))}var Le=Symbol("MAIN_MAP_CONTROLLER"),Ue=a("0710"),Re=a("698f");function Ge(e){var t=function(t){"backPressed"===t.state&&e()};window.history.pushState("backPressed","",null),window.history.pushState("dummy","",null),window.addEventListener("popstate",t,{once:!0}),Object(l["f"])((function(){window.removeEventListener("popstate",t)}))}var Ne=Symbol("GASymbol");function Be(e){Object(l["g"])(Ne,e.root.$gtag)}function De(){var e=Object(l["d"])(Ne);if(!e)throw new Error("use provideGA before useGA");var t=function(t){e.pageview({page_path:t})},a=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.event(t,a)};return{pageview:t,event:a}}var Ve=Symbol("GASymbol"),$e=function(){var e=Object(l["h"])({updateFactorySuccessModal:!1,createFactorySuccessModal:!1,aboutModalOpen:!1,contactModalOpen:!1,safetyModalOpen:!1,gettingStartedModalOpen:"true"!==localStorage.getItem("use-app"),sidebarOpen:!1});return Object(l["g"])(Ve,e),e},qe=function(){var e=Object(l["d"])(Ve),t=De(),a=t.event,n=function(){e.updateFactorySuccessModal=!0},o=function(){e.updateFactorySuccessModal=!1},r=function(){e.createFactorySuccessModal=!0},i=function(){e.createFactorySuccessModal=!1},c=function(){e.aboutModalOpen=!0},s=function(){e.aboutModalOpen=!1},u=function(){e.contactModalOpen=!0},p=function(){e.contactModalOpen=!1},d=function(){e.safetyModalOpen=!0},f=function(){e.safetyModalOpen=!1},m=function(){e.gettingStartedModalOpen=!0},v=function(){e.gettingStartedModalOpen=!1},y=function(){var t=!e.sidebarOpen;a("toggleSidebar",{target:t}),e.sidebarOpen=t},g={openUpdateFactorySuccessModal:n,closeUpdateFactorySuccessModal:o,openCreateFactorySuccessModal:r,closeCreateFactorySuccessModal:i,openAboutModal:c,closeAboutModal:s,openContactModal:u,closeContactModal:p,openSafetyModal:d,closeSafetyModal:f,openGettingStartedModal:m,closeGettingStartedModal:v,toggleSidebar:y};return[e,g]},ze=Object(l["b"])({components:{AppButton:S,AppNavbar:k},props:{openCreateFactoryForm:{type:Function,required:!0},openEditFactoryForm:{type:Function,required:!0},selectFactoryMode:{type:Boolean,required:!0},enterSelectFactoryMode:{type:Function,required:!0},exitSelectFactoryMode:{type:Function,required:!0},setFactoryLocation:{type:Function,required:!0},openFilterModal:{type:Function,required:!0}},setup:function(e){var t=De(),a=t.event,n=Object(l["i"])(null),r=Object(l["i"])(null),i=Object(l["i"])(!1),c=Object(l["i"])([]),u=Object(l["d"])(Le,Object(l["i"])()),p=qe(),m=Object(s["a"])(p,2),v=m[1],y=Object(l["i"])({show:!1,id:"",name:"",color:"",status:"",summary:""}),g=Object(l["i"])(null),b=function(e){var t=e.images.length>0?"已有照片":"缺照片",a=ee.find((function(t){return t.value===e.type})),n=a&&a.text||"其他";return n.includes("金屬")&&(n="金屬"),[t,n].filter(Boolean).join("\n")},h=function(e){if(u.value){var t=u.value.getFactory(e);if(t){y.value.id=t.id,y.value.name=t.name;var a=me(t);y.value.color=fe(a),y.value.status=ae[a][0],y.value.show=!0,y.value.summary=b(t),g.value=t}}},S=function(){g.value&&e.openEditFactoryForm(g.value)};Object(l["e"])((function(){var e=new Ue["a"]({element:r.value,positioning:Re["a"].BOTTOM_LEFT}),t=we(n.value,{onMoved:function(e,n){var o=Object(s["a"])(e,3),r=o[0],l=o[1],u=o[2];return Object(f["a"])(this,void 0,void 0,regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i.value=n,c.value=[r,l],a("moveMap"),e.prev=3,e.next=6,Ce(u,r,l);case 6:o=e.sent,Array.isArray(o)&&t.addFactories(o),e.next=12;break;case 10:e.prev=10,e.t0=e["catch"](3);case 12:case"end":return e.stop()}}),e,null,[[3,10]])})))},onClicked:function(t,n){return Object(f["a"])(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n?(a("clickPopup"),e.setPosition(n.getGeometry().getCoordinates()),h(n.getId())):y.value.show=!1;case 1:case"end":return t.stop()}}),t)})))}});t.mapInstance.map.addOverlay(e),u.value=t,t.mapInstance.setLUILayerVisible(!1)}));var F=function(){u.value&&u.value.mapInstance.setLUILayerVisible(!1),e.exitSelectFactoryMode()};function O(){u.value&&(u.value.mapInstance.setLUILayerVisible(!0),e.enterSelectFactoryMode(),y.value.show=!1,Ge(F))}function _(){u.value&&(u.value.mapInstance.setLUILayerVisible(!1),e.setFactoryLocation(c.value),e.exitSelectFactoryMode(),e.openCreateFactoryForm())}return{root:n,modalActions:v,popup:r,factoryValid:i,zoomToGeolocation:function(){u.value&&(a("zoomToGeolocation"),u.value.mapInstance.zoomToGeolocation())},onNavBack:function(){F()},popupData:y,onClickEditFactoryData:S,onClickCreateFactoryButton:O,onClickFinishSelectFactoryPositionButton:_,getButtonColorFromStatus:function(){var e;if(!g.value)return"default";var t=me(g.value);return(e={},Object(d["a"])(e,o.NEW,"blue"),Object(d["a"])(e,o.EXISTING_INCOMPLETE,"gray"),Object(d["a"])(e,o.EXISTING_COMPLETE,"gray"),Object(d["a"])(e,o.REPORTED,"default"),e)[t]}}}}),Xe=ze,We=(a("3a8e"),Object(b["a"])(Xe,u,p,!1,null,"6d6ee544",null)),He=We.exports,Je=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:{base:!0,open:e.value},on:{click:e.close}},[a("div",{class:{sidebar:!0,open:e.value}},[a("div",{staticClass:"close",on:{click:e.close}}),a("h1",[e._v("主選單")]),a("hr"),a("ul",e._l(e.links,(function(t,n){return a("li",{key:n},[a("a",{on:{click:function(t){return t.stopPropagation(),e.clickActions[n](t)}}},[e._v(e._s(t.text))])])})),0)])])},Ye=[],Ze=Object(l["b"])({name:"AppSidebar",props:{value:{type:Boolean,required:!0},clickActions:{type:Array,required:!0,default:[]}},setup:function(e,t){var a=Object(l["i"])([{text:"使用教學"},{text:"安全須知"},{text:"聯絡我們"},{text:"關於舉報系統"}]),n=function(){t.emit("input",!1)};return{links:a,close:n}}}),Ke=Ze,Qe=(a("49a2"),Object(b["a"])(Ke,Je,Ye,!1,null,"5af25fd2",null)),et=Qe.exports,tt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"navbar-container"},[a("app-navbar",{attrs:{dark:!1,fixed:!0},on:{back:e.onNavBack,menu:e.modalActions.toggleSidebar}},[e._v(" "+e._s(e.isCreateMode?"新增資訊":"補充資訊")+" ")])],1),a("div",{staticClass:"page-container",class:{hide:e.selectFactoryMode}},[a("image-upload-modal",{attrs:{open:e.formPageState.imageUploadModalOpen,dismiss:e.closeImageUploadModal,images:e.imagesToUpload,finishImagesUpload:e.finishImagesUpload,finishUploaderForm:e.finishUploaderForm,mode:e.mode,factoryData:e.factoryData}}),a("div",{staticClass:"page",staticStyle:{padding:"29px 35px"}},[e.isCreateMode?a("h1",[e._v(" 輸入資訊 ")]):e._e(),e.isCreateMode?e._e():a("div",{staticClass:"status-banner flex",style:{backgroundColor:e.getStatusBorderColor(e.factoryFormState.status)}},[a("img",{staticStyle:{"margin-right":"7px"},attrs:{src:"/images/marker-white.svg"}}),e._v(" "+e._s(e.FactoryStatusText[e.factoryFormState.status][0])+" ")]),a("h3",[e._v("工廠地點")]),a("div",{ref:"minimap",staticClass:"minimap",on:{click:function(t){return e.onClickMinimap()}}}),a("div",{staticClass:"flex justify-between",staticStyle:{"margin-top":"40px","margin-bottom":"20px"}},[e._m(0),a("div",[a("label",[a("input",{ref:"image",staticStyle:{visibility:"hidden",position:"absolute","pointer-events":"none",left:"-1000px"},attrs:{multiple:"",type:"file",accept:"image/*"},on:{change:e.handleImagesUpload}}),e.isiOS||e.isSafari?a("app-button",[e._v("新增")]):a("app-button",{on:{click:e.onClickImageUpload}},[e._v("新增")])],1)])]),a("div",{staticClass:"images-grid"},e._l(e.factoryFormState.imageUrls,(function(e){return a("div",{key:e,staticClass:"image-card"},[a("img",{attrs:{src:e}})])})),0),a("h3",[e._v("工廠名稱")]),a("div",{staticClass:"flex align-items-center"},[a("div",{staticClass:"flex-auto"},[a("app-text-field",{attrs:{placeholder:"請輸入工廠名稱"},model:{value:e.factoryFormState.name,callback:function(t){e.$set(e.factoryFormState,"name",t)},expression:"factoryFormState.name"}})],1),e.isEditMode?a("div",{staticStyle:{width:"100px",height:"47px","margin-left":"-3px"}},[a("app-button",{attrs:{rect:"",disabled:e.fieldSubmittingState.name_submitting},on:{click:function(t){return e.updateFactoryFieldsFor("name",e.factoryFormState.name)}}},[e._v(" "+e._s(e.fieldSubmittingState.name_submitting?"更新中":"更新")+" ")])],1):e._e()]),a("h3",[e._v("工廠類型")]),a("div",{staticClass:"flex align-items-center"},[a("div",{staticClass:"flex-auto"},[a("app-select",{attrs:{items:e.factoryTypeItems},model:{value:e.factoryFormState.type,callback:function(t){e.$set(e.factoryFormState,"type",t)},expression:"factoryFormState.type"}})],1),e.isEditMode?a("div",{staticStyle:{width:"100px",height:"47px","margin-left":"-3px"}},[a("app-button",{attrs:{rect:"",disabled:e.fieldSubmittingState.factory_type_submitting},on:{click:function(t){return e.updateFactoryFieldsFor("factory_type",e.factoryFormState.type)}}},[e._v(" "+e._s(e.fieldSubmittingState.factory_type_submitting?"更新中":"更新")+" ")])],1):e._e()]),a("h3",[e._v("新增其它資訊")]),a("div",{staticClass:"flex align-items-center"},[a("div",{staticClass:"flex-auto"},[a("app-text-field",{attrs:{placeholder:"請填入其他資訊，如聲音、氣味等等。"},model:{value:e.factoryFormState.others,callback:function(t){e.$set(e.factoryFormState,"others",t)},expression:"factoryFormState.others"}})],1),e.isEditMode?a("div",{staticStyle:{width:"100px",height:"47px","margin-left":"-3px"}},[a("app-button",{attrs:{rect:"",disabled:e.fieldSubmittingState.others_submitting},on:{click:function(t){return e.updateFactoryFieldsFor("others",e.factoryFormState.others)}}},[e._v(" "+e._s(e.fieldSubmittingState.others_submitting?"更新中":"更新")+" ")])],1):e._e()]),e.isCreateMode?a("div",{staticClass:"text-center width-auto",staticStyle:{"margin-top":"60px"}},[a("app-button",{attrs:{disabled:!e.formPageState.valid||e.formPageState.submitting},on:{click:function(t){return e.submitFactory()}}},[e._v(" "+e._s(e.formPageState.submitting?"上傳資料中":"送出")+" ")])],1):e._e()])],1)])},at=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"flex flex-column flex-auto"},[a("h3",{staticStyle:{"margin-top":"0"}},[e._v("工廠照片*")]),a("label",[a("small",[e._v("請上傳至少一張照片")])])])}],nt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return"checkbox"===e.type?a("input",e._b({directives:[{name:"model",rawName:"v-model",value:e.inputValue,expression:"inputValue"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.inputValue)?e._i(e.inputValue,null)>-1:e.inputValue},on:{change:function(t){var a=e.inputValue,n=t.target,o=!!n.checked;if(Array.isArray(a)){var r=null,i=e._i(a,r);n.checked?i<0&&(e.inputValue=a.concat([r])):i>-1&&(e.inputValue=a.slice(0,i).concat(a.slice(i+1)))}else e.inputValue=o}}},"input",e.$attrs,!1)):"radio"===e.type?a("input",e._b({directives:[{name:"model",rawName:"v-model",value:e.inputValue,expression:"inputValue"}],attrs:{type:"radio"},domProps:{checked:e._q(e.inputValue,null)},on:{change:function(t){e.inputValue=null}}},"input",e.$attrs,!1)):a("input",e._b({directives:[{name:"model",rawName:"v-model",value:e.inputValue,expression:"inputValue"}],attrs:{type:e.type},domProps:{value:e.inputValue},on:{input:function(t){t.target.composing||(e.inputValue=t.target.value)}}},"input",e.$attrs,!1))},ot=[],rt=Object(l["b"])({name:"AppTextField",props:{type:{type:String,default:"text"},value:{type:String,required:!0}},setup:function(e,t){var a=Object(l["a"])({get:function(){return e.value},set:function(e){return t.emit("input",e)}});return{inputValue:a}}}),it=rt,ct=(a("6bd7"),Object(b["a"])(it,nt,ot,!1,null,"1dc8b942",null)),st=ct.exports,lt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"select"},[a("select",e._b({directives:[{name:"model",rawName:"v-model",value:e.inputValue,expression:"inputValue"}],on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.inputValue=t.target.multiple?a:a[0]}}},"select",e.$attrs,!1),e._l(e.items,(function(t){return a("option",{key:t.value,domProps:{value:t.value}},[e._v(" "+e._s(t.text)+" ")])})),0)])},ut=[],pt=Object(l["b"])({name:"AppSelect",props:{value:{type:null,required:!0},items:{type:Array,required:!0}},setup:function(e,t){var a=Object(l["a"])({get:function(){return e.value},set:function(e){return t.emit("input",e)}});return{inputValue:a}}}),dt=pt,ft=(a("312b"),Object(b["a"])(dt,lt,ut,!1,null,"4f226c2f",null)),mt=ft.exports,vt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("app-modal",{staticClass:"page",attrs:{open:e.open,dismiss:e.closeModal}},[a("h2",[e._v("工廠照片")]),a("div",{staticClass:"images-grid"},e._l(e.imageUrls,(function(e){return a("div",{key:e,staticClass:"image-card"},[a("img",{attrs:{src:e}})])})),0),a("h2",[e._v(" 聯絡資訊（非必填）"),a("br"),a("small",{staticStyle:{"font-size":"14px"}},[e._v("如果對於照片有疑問，我們會透過您提供的資訊聯絡你。")])]),a("h3",[e._v("稱呼")]),a("app-text-field",{attrs:{placeholder:"例：林先生"},model:{value:e.formState.nickname,callback:function(t){e.$set(e.formState,"nickname",t)},expression:"formState.nickname"}}),a("h3",[e._v("聯絡資料")]),a("app-text-field",{attrs:{placeholder:"例：0912345678"},model:{value:e.formState.contact,callback:function(t){e.$set(e.formState,"contact",t)},expression:"formState.contact"}}),a("div",{staticStyle:{"margin-top":"35px"}},[a("app-button",{attrs:{disabled:e.formState.uploading},on:{click:function(t){return e.handleImagesUpload()}}},[e._v(" "+e._s(e.formState.uploading?"上傳中":"上傳照片")+" ")])],1)],1)},yt=[],gt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-modal-component",class:{open:e.open}},[a("div",{staticClass:"app-modal-backdrop",on:{click:e.dismiss}}),a("div",{staticClass:"app-modal"},[e.showCloseButon?a("div",{staticClass:"close",on:{click:e.dismiss}}):e._e(),e._t("default")],2)])},bt=[],ht=Object(l["b"])({name:"AppModal",props:{open:{type:Boolean,default:!1},dismiss:{type:Function},showCloseButon:{type:Boolean,default:!0}}}),St=ht,Ft=(a("198a"),Object(b["a"])(St,gt,bt,!1,null,"0999ded1",null)),Ot=Ft.exports,_t=Object(l["b"])({name:"FilterModal",components:{AppModal:Ot,AppButton:S,AppTextField:st},props:{open:{type:Boolean,default:!1},dismiss:{type:Function,required:!0},images:{type:FileList},finishImagesUpload:{type:Function,required:!0},finishUploaderForm:{type:Function,required:!0},mode:{type:String,required:!0,defaultValue:"create"},factoryData:{type:Object,required:!0}},setup:function(e){var t=De(),a=t.event,n=Object(l["h"])({nickname:"",contact:"",uploading:!1}),o=Object(l["a"])((function(){for(var t=[],a=0;a<e.images.length;a++)t.push(URL.createObjectURL(e.images[a]));return t}));return{formState:n,imageUrls:o,handleImagesUpload:function(){return Object(f["a"])(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n.uploading=!0,"create"!==e.mode){t.next=20;break}return t.prev=2,a("uploadImages"),t.next=6,Ie(e.images);case 6:return r=t.sent,e.finishUploaderForm(n.nickname,n.contact),t.next=10,e.finishImagesUpload(r,o);case 10:n.uploading=!1,e.dismiss(),t.next=18;break;case 14:t.prev=14,t.t0=t["catch"](2),n.uploading=!1,console.error(t.t0);case 18:t.next=29;break;case 20:return a("updateFactoryImages"),t.next=23,Ae(e.factoryData.id,e.images,{nickname:n.nickname,contact:n.contact});case 23:return i=t.sent,e.finishUploaderForm(n.nickname,n.contact),t.next=27,e.finishImagesUpload(i,[]);case 27:n.uploading=!1,e.dismiss();case 29:case"end":return t.stop()}}),t,null,[[2,14]])})))},closeModal:function(){n.uploading||(e.finishImagesUpload([]),e.finishUploaderForm("",""),e.dismiss())}}}}),wt=_t,Mt=(a("f8c3"),Object(b["a"])(wt,vt,yt,!1,null,"219bceb2",null)),kt=Mt.exports,xt=(a("0d03"),a("ac1f"),a("25f0"),a("466d"),!(!navigator.userAgent.match(/(iPod|iPhone|iPad)/)||!navigator.userAgent.match(/AppleWebKit/))),Et=/constructor/i.test(window.HTMLElement)||function(e){return"[object SafariRemoteNotification]"===e.toString()}(!window.safari||"undefined"!==typeof window.safari&&window.safari.pushNotification),jt=Object(l["b"])({name:"FormPage",components:{AppButton:S,AppTextField:st,AppSelect:mt,AppNavbar:k,ImageUploadModal:kt},props:{close:{type:Function,required:!0},selectFactoryMode:{type:Boolean,required:!0},enterSelectFactoryMode:{type:Function,required:!0},exitSelectFactoryMode:{type:Function,required:!0},factoryLocation:{type:Array,required:!0},setCreateFactorySuccessModal:{type:Function,required:!0},mode:{type:String,required:!0,defaultValue:"create"},factoryData:{type:Object,required:!0}},setup:function(e){var t,a=this,n=De(),o=n.event,r=Object(l["d"])(Le,Object(l["i"])()),i=qe(),c=Object(s["a"])(i,2),u=c[1],p=function(){r.value&&(r.value.mapInstance.setLUILayerVisible(!1),e.close(),e.exitSelectFactoryMode())};Ge(p);var m="edit"===e.mode,v="create"===e.mode,y=[{text:"請選擇工廠類型",value:"0"}].concat(Object(x["a"])(ee)),g={name:"",others:"",type:"0",lng:0,lat:0,images:[],imageUrls:[],nickname:"",contact:"",status:""};if(m){var b=e.factoryData;g.name=b.name,g.type=b.factory_type,g.others=b.others,g.imageUrls=b.images.map((function(e){return e.image_path})),g.lng=b.lng,g.lat=b.lat,g.status=me(b)}var h=Object(l["h"])(g),S=Object(l["h"])({imageUploadModalOpen:!1,valid:!1,submitting:!1}),F=Object(l["h"])({name_submitting:!1,factory_type_submitting:!1,others_submitting:!1});Object(l["j"])((function(){var e=h.images,t=e.length>0;S.valid=t}));var O=function(){S.imageUploadModalOpen=!1,o("closeImageUploadModal")},_=function(){S.imageUploadModalOpen=!0,o("openImageUploadModal")},w=Object(l["i"])([]),M=Object(l["i"])(null),k=function(e,t){h.nickname=e,h.contact=t},E=function(t,n){return Object(f["a"])(a,void 0,void 0,regeneratorRuntime.mark((function a(){var i,c,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=e.factoryData,m&&i){a.next=3;break}return a.abrupt("return");case 3:return c="".concat(t,"_submitting"),a.prev=4,F[c]=!0,o("updateFactory",{field:t}),a.next=9,Pe(i.id,Object(d["a"])({},t,n));case 9:s=a.sent,F[c]=!1,r.value&&r.value.updateFactory(i.id,s),u.openUpdateFactorySuccessModal(),a.next=18;break;case 15:a.prev=15,a.t0=a["catch"](4),console.error(a.t0);case 18:case"end":return a.stop()}}),a,null,[[4,15]])})))},j=Object(l["i"])(null);return Object(l["e"])((function(){if(r.value){var a=r.value,n=a.mapInstance.map.getView().getCenter();if(t=Me(j.value,n),t.addFactories(a.factories),m){var o=e.factoryData;t.mapInstance.setMinimapPin(o.lng,o.lat)}else if(v){var i=Object(s["a"])(e.factoryLocation,2),c=i[0],l=i[1];t.mapInstance.setMinimapPin(c,l)}}})),Object(l["j"])((function(){return e.factoryLocation}),(function(){if(v&&t){var a=Object(s["a"])(e.factoryLocation,2),n=a[0],o=a[1];t.mapInstance.setMinimapPin(n,o)}})),{minimap:j,onClickMinimap:function(){v&&r.value&&(r.value.mapInstance.setLUILayerVisible(!0),e.enterSelectFactoryMode())},factoryFormState:h,formPageState:S,fieldSubmittingState:F,factoryTypeItems:y,containerStyle:{width:"100%"},openImageUploadModal:_,closeImageUploadModal:O,imagesToUpload:w,image:M,isiOS:xt,isSafari:Et,onClickImageUpload:function(){M.value.click()},handleImagesUpload:function(e){w.value=e.target.files,_()},finishImagesUpload:function(t,a){return Object(f["a"])(this,void 0,void 0,regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(v)h.imageUrls=a,h.images=t.map((function(e){return e.token}));else if(m)try{o=Object.assign({},e.factoryData),h.imageUrls=h.imageUrls.concat(t.map((function(e){return e.image_path}))),o.images=o.images.concat(t),r.value&&r.value.updateFactory(e.factoryData.id,o),u.openUpdateFactorySuccessModal()}catch(i){console.error(i)}case 1:case"end":return n.stop()}}),n)})))},onNavBack:function(){r.value&&p()},submitFactory:function(){return Object(f["a"])(this,void 0,void 0,regeneratorRuntime.mark((function t(){var a,n,i,c,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return S.submitting=!0,t.prev=1,a=Object(s["a"])(e.factoryLocation,2),n=a[0],i=a[1],c={name:h.name,others:h.others,type:h.type,lng:n,lat:i,images:h.images,nickname:h.nickname,contact:h.contact},o("createFactory",{lng:n,lat:i}),t.next=7,Te(c);case 7:l=t.sent,r.value&&r.value.addFactories([l]),t.next=13;break;case 11:t.prev=11,t.t0=t["catch"](1);case 13:return t.prev=13,S.submitting=!1,t.finish(13);case 16:e.close(),e.exitSelectFactoryMode(),e.setCreateFactorySuccessModal(!0);case 19:case"end":return t.stop()}}),t,null,[[1,11,13,16]])})))},finishUploaderForm:k,isEditMode:m,isCreateMode:v,updateFactoryFieldsFor:E,getStatusBorderColor:fe,FactoryStatusText:ae,getFactoryStatus:me,modalActions:u}}}),Ct=jt,It=(a("a470"),Object(b["a"])(Ct,tt,at,!1,null,"45ad3b82",null)),At=It.exports,Tt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"filter-modal-container"},[a("app-modal",{attrs:{open:e.open,dismiss:e.dismiss}},[a("div",{staticClass:"page"},[a("div",{staticClass:"page-inner"},[a("h2",{staticStyle:{"margin-right":"30px"}},[e._v("篩選")]),e._l(e.FACTORY_STATUS_ITEMS,(function(t){return a("label",{key:t,staticClass:"checkbox-container"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.filters[t],expression:"filters[status]"}],attrs:{type:"checkbox",name:t},domProps:{checked:Array.isArray(e.filters[t])?e._i(e.filters[t],null)>-1:e.filters[t]},on:{change:function(a){var n=e.filters[t],o=a.target,r=!!o.checked;if(Array.isArray(n)){var i=null,c=e._i(n,i);o.checked?c<0&&e.$set(e.filters,t,n.concat([i])):c>-1&&e.$set(e.filters,t,n.slice(0,c).concat(n.slice(c+1)))}else e.$set(e.filters,t,r)}}}),a("span",{staticClass:"checkbox"}),a("span",{staticClass:"data-type",class:{"has-description":e.FactoryStatusText[t][1]}},[e._v(" "+e._s(e.FactoryStatusText[t][0])+" "),e.FactoryStatusText[t][1]?a("small",[e._v(e._s(e.FactoryStatusText[t][1]))]):e._e()]),a("span",{staticClass:"space"}),a("img",{attrs:{src:"/images/marker-"+t+".svg"}})])}))],2),a("div",{staticStyle:{"margin-bottom":"10px"}},[a("app-button",{on:{click:function(t){return e.onClick()}}},[e._v("確認")])],1)])])],1)},Pt=[],Lt=Object(l["b"])({name:"FilterModal",components:{AppModal:Ot,AppButton:S},props:{open:{type:Boolean,default:!1},dismiss:{type:Function}},setup:function(e){var t,a=Object(l["h"])((t={},Object(d["a"])(t,o.NEW,!1),Object(d["a"])(t,o.EXISTING_INCOMPLETE,!1),Object(d["a"])(t,o.EXISTING_COMPLETE,!1),Object(d["a"])(t,o.REPORTED,!1),t)),n=Object(l["d"])(Le,Object(l["i"])());return{filters:a,onClick:function(){if(n.value){var t=Object.entries(a).map((function(e){var t=Object(s["a"])(e,2),a=t[0],n=t[1];return!!n&&a})).filter(Boolean);n.value.setFactoryStatusFilter(t),"function"===typeof e.dismiss&&e.dismiss()}},FACTORY_STATUS_ITEMS:ne,FactoryStatus:o,FactoryStatusText:ae}}}),Ut=Lt,Rt=(a("3a40"),Object(b["a"])(Ut,Tt,Pt,!1,null,null,null)),Gt=Rt.exports,Nt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"about-dialog-container"},[a("app-modal",{attrs:{open:e.open,dismiss:e.dismiss}},[a("div",{staticClass:"page"},[a("h3",[e._v("關於舉報系統")]),a("p",[e._v(" 農地違章工廠舉報系統為協助民眾回報揭露農地違章工廠資訊，並非實際完成舉報。 ")]),a("p",[e._v(" 地球公民基金會將整理資料進行部分案件追蹤，完成舉報者可於「已舉報」案件查見。 ")]),a("p",[e._v(" 105.05.20 前的違章工廠我們將持續收集資訊，但本系統優先針對新增建與中高污染違章工廠進行舉報。 ")]),a("p",[e._v(" 本系統感謝 g0v.tw 社群朋友共同開發。 ")]),a("p",[e._v(" 全站原始碼以 MIT 開放授權公開在 https://github.com/Disfactory/Disfactory。 ")])])])],1)},Bt=[],Dt=Object(l["b"])({name:"AboutModal",components:{AppModal:Ot},props:{open:{type:Boolean,default:!1},dismiss:{type:Function}}}),Vt=Dt,$t=(a("9769"),Object(b["a"])(Vt,Nt,Bt,!1,null,null,null)),qt=$t.exports,zt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"contact-modal-container"},[a("app-modal",{attrs:{open:e.open,dismiss:e.dismiss}},[a("div",{staticClass:"page"},[a("img",{attrs:{width:"137",src:"/images/cet-logo.png",alt:"Citizen of the Earth Taiwan"}}),a("h3",[e._v(" 有任何舉報相關問題"),a("br"),e._v(" 歡迎聯絡 ")]),a("p",[e._v(" 地球公民基金會"),a("br"),e._v(" TEL: 07-2156809"),a("br"),e._v(" Email: "),a("a",{attrs:{href:"mailto:cet@cet-taiwan.org"}},[e._v("cet@cet-taiwan.org")]),a("br")])])])],1)},Xt=[],Wt=Object(l["b"])({name:"ContactModal",components:{AppModal:Ot},props:{open:{type:Boolean,default:!1},dismiss:{type:Function}}}),Ht=Wt,Jt=(a("f3e5"),Object(b["a"])(Ht,zt,Xt,!1,null,null,null)),Yt=Jt.exports,Zt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"getting-started-container"},[a("app-modal",{attrs:{open:e.open,dismiss:e.dismiss}},[a("div",{staticClass:"page"},[a("pre",[e._v("        嗨，歡迎來到農地違章工廠舉報小幫手！\n        你回報的新增建違章工廠\n        既有中高污染工廠\n        會由地球公民基金會\n        做案件追蹤\n        向政府進行舉報\n\n        使用教學在右上角"),a("img",{attrs:{width:"30",src:"/images/menu-pic.png"}}),e._v("喔！\n\n        本網站由地球公民基金會與 g0v 社群共同開發\n      ")])])])],1)},Kt=[],Qt=Object(l["b"])({name:"GettingStartedModal",components:{AppModal:Ot},props:{open:{type:Boolean,default:!1},dismiss:{type:Function}}}),ea=Qt,ta=(a("d1c5"),Object(b["a"])(ea,Zt,Kt,!1,null,null,null)),aa=ta.exports,na=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"safety-modal-container"},[a("app-modal",{attrs:{open:e.open,dismiss:e.dismiss}},[a("div",{staticClass:"page"},[a("carousel",{attrs:{"per-page":1,paginationActiveColor:"#6E8501",paginationColor:"#e3e3e3",paginationPadding:5}},[a("slide",[a("h1",[e._v("安全須知")]),a("p",[e._v(" 請參考以下建議，前往違章工廠拍照蒐證 ")])]),a("slide",[a("img",{attrs:{src:"/images/safety_notice/1.png",alt:""}}),a("h2",[e._v(" 場勘 ")]),a("p",[e._v(" 假裝路過，檢查有無監視器；尋找適合拍照的隱蔽處 ")])]),a("slide",[a("img",{attrs:{src:"/images/safety_notice/2.png",alt:""}}),a("h2",[e._v("藏身")]),a("p",[e._v(" 盡量避開監視器、他人視線；盡量在隱蔽處拍照（例如：車上、民宅內、樹叢間、遠方） ")])]),a("slide",[a("img",{attrs:{src:"/images/safety_notice/3.png",alt:""}}),a("h2",[e._v("避嫌")]),a("p",[e._v("假如地點不夠隱密，請用手機拍照，降低他人戒心")])]),a("slide",[a("img",{attrs:{src:"/images/safety_notice/4.png",alt:""}}),a("h2",[e._v("速離")]),a("p",[e._v("拍到1張清晰照片即可離去")])]),a("slide",[a("img",{attrs:{src:"/images/safety_notice/5.png",alt:""}}),a("h2",[e._v("應變")]),a("p",[e._v("假如有人上前問話，請表現得「充滿好奇心」，試著跟對方聊天（例如：好奇水電師傅的施工技術），再伺機離開。")])])],1)],1)])],1)},oa=[],ra=a("0a63"),ia=Object(l["b"])({name:"SafetyModal",components:{AppModal:Ot,Carousel:ra["Carousel"],Slide:ra["Slide"]},props:{open:{type:Boolean,default:!1},dismiss:{type:Function}}}),ca=ia,sa=(a("0751"),Object(b["a"])(ca,na,oa,!1,null,null,null)),la=sa.exports,ua=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("app-modal",{attrs:{open:e.open,dismiss:e.dismiss,showCloseButon:!1}},[a("h3",[e._v("感謝您新增資訊！")]),a("app-button",{on:{click:e.dismiss}},[e._v("確認")])],1)},pa=[],da=Object(l["b"])({name:"CreateFactorySuccessModal",components:{AppModal:Ot,AppButton:S},props:{open:{type:Boolean,default:!1},dismiss:{type:Function}}}),fa=da,ma=(a("ccd1"),Object(b["a"])(fa,ua,pa,!1,null,"3436fde9",null)),va=ma.exports,ya=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("app-modal",{attrs:{open:e.open,dismiss:e.dismiss,showCloseButon:!1}},[a("h3",[e._v("感謝您補充資訊！")]),a("app-button",{on:{click:e.dismiss}},[e._v("確認")])],1)},ga=[],ba=Object(l["b"])({name:"UpdateFactorySuccessModal",components:{AppModal:Ot,AppButton:S},props:{open:{type:Boolean,default:!1},dismiss:{type:Function}}}),ha=ba,Sa=(a("c96d"),Object(b["a"])(ha,ya,ga,!1,null,"18cc98a4",null)),Fa=Sa.exports,Oa=Object(l["b"])({name:"App",components:{Map:He,AppButton:S,AppNavbar:k,AppSidebar:et,FilterModal:Gt,AboutModal:qt,ContactModal:Yt,GettingStartedModal:aa,SafetyModal:la,CreateFactorySuccessModal:va,UpdateFactorySuccessModal:Fa,FormPage:At},setup:function(e,t){Be(t),$e(),localStorage.setItem("use-app","true");var a=qe(),n=Object(s["a"])(a,2),o=n[0],r=n[1],i=De(),c=i.pageview,u=i.event,p=Object(l["h"])({filterModalOpen:!1,formMode:"create",factoryFormOpen:!1,factoryData:null,factoryLocation:[],selectFactoryMode:!1});function d(){u("closeFilterModal"),p.filterModalOpen=!1}function f(){u("openFilterModal"),p.filterModalOpen=!0}var m=function(){p.factoryData=null,p.formMode="create",p.factoryFormOpen=!0,c("/create")},v=function(e){p.factoryData=e,p.formMode="edit",p.factoryFormOpen=!0,c("/edit")};function y(){p.factoryFormOpen=!1,u("closeFactoryPage")}var g=function(e){p.factoryLocation=e,u("setFactoryLocation")};function b(){p.selectFactoryMode=!0,u("enterSelectFactoryMode")}function h(){p.selectFactoryMode=!1,u("exitSelectFactoryMode")}return Object(l["g"])(Le,Object(l["i"])(null)),{appState:p,sidebarActions:[function(){},r.openSafetyModal,r.openContactModal,r.openAboutModal],openFilterModal:f,closeFilterModal:d,openCreateFactoryForm:m,openEditFactoryForm:v,closeFactoryPage:y,enterSelectFactoryMode:b,exitSelectFactoryMode:h,setFactoryLocation:g,modalState:o,modalActions:r}}}),_a=Oa,wa=(a("5c0b"),Object(b["a"])(_a,i,c,!1,null,null,null)),Ma=wa.exports,ka=a("2bdd"),xa=a.n(ka);r["a"].config.productionTip=!1,r["a"].use(l["c"]),r["a"].use(xa.a,{config:{id:"UA-154739393-1"},enabled:!0}),new r["a"]({render:function(e){return e(Ma)}}).$mount("#app")},d1c5:function(e,t,a){"use strict";var n=a("8271"),o=a.n(n);o.a},d54a:function(e,t,a){"use strict";var n=a("aee9"),o=a.n(n);o.a},f3e5:function(e,t,a){"use strict";var n=a("31aa"),o=a.n(n);o.a},f683:function(e,t,a){},f8c3:function(e,t,a){"use strict";var n=a("fae5"),o=a.n(n);o.a},fae5:function(e,t,a){}});
//# sourceMappingURL=app.cd097105.js.map